# B2B Platform — API Contracts (OpenAPI)

Сейчас репозиторий намеренно минимальный: **единственный source of truth — `api-contracts.yaml`** (OpenAPI 3.0), описывающий все HTTP-контракты будущей системы.

Цель: сначала зафиксировать контракты (эндпоинты/запросы/ответы/ошибки), и только потом параллельно собирать backend, frontend и worker’ы, чтобы все части системы “говорили” на одном языке.

---

## Что есть в репозитории сейчас

- `api-contracts.yaml` — OpenAPI спецификация (контракты всех endpoints).
- README — этот файл.

Рекомендуемая будущая структура (когда начнём добавлять код):
b2b-platform/
api-contracts.yaml
README.md
backend/ # FastAPI/Node/etc (появится позже)
frontend/ # React/Vue/etc (появится позже)
docs/ # дополнительные документы (появится позже)
db/ # миграции, схема, сиды (появится позже)

text

---

## Как открыть спецификацию (самый быстрый способ)

### Вариант A — VS Code (самый удобный)
1) Открой папку проекта в VS Code  
2) Установи расширение **Swagger Viewer**  
3) Открой `api-contracts.yaml` → Preview (расширение показывает документацию по файлу)

Это удобно, потому что предпросмотр обновляется “на лету”, пока правишь YAML.

### Вариант B — Swagger UI / Redoc (позже)
Когда появится backend, он будет:
- отдавать Swagger UI по `/docs`
- отдавать OpenAPI JSON по `/openapi.json` (или аналогично)

Но на текущем этапе достаточно VS Code предпросмотра.

---

## Правила работы с `api-contracts.yaml`

### 1) Контракты — прежде кода
Любое изменение логики (новый endpoint, новое поле, новый статус) сначала делаем в `api-contracts.yaml`, затем реализуем в backend/frontend.

### 2) Названия и стабильность
- Пути: `/api/v1/...` (версионирование в URL)
- Все ответы ошибок приводим к единому формату `ErrorResponse`
- Добавление новых полей в ответы — ок (backward compatible)
- Переименование/удаление полей — только через новую версию API или через deprecation период

### 3) Вложения — “как надо”
Вложения для писем не передаются бинарниками в JSON.
Правильный поток:
1) `POST /user/attachments` → получить `attachment_id`
2) `POST /user/requests/{id}/send` → передать `attachment_ids: [..]`

---

## Генерация клиентов (когда понадобится)

Когда подключим фронтенд, типовой путь:
- генерировать типы/клиента из OpenAPI
- использовать их в UI, чтобы не было рассинхрона полей

Пример (TypeScript-клиент) — будет добавлен отдельным скриптом в проект, когда появится `frontend/`.

---

## План следующего шага (куда двигаемся далее)

Следом создаём “скелет” backend (без бизнес-логики, только каркас под контракты):
1) Создать папку `backend/` и минимальный сервер (FastAPI или другой стек)
2) Подключить роутинг `/api/v1`
3) Поднять Swagger UI и сверить, что runtime OpenAPI совпадает с `api-contracts.yaml`
4) Реализовать первые 2–3 endpoint’а “вхолостую” (mock), чтобы фронт мог начать разработку

---

## Как будем принимать решения по контрактам

Перед добавлением новой фичи фиксируем:
- какой endpoint
- какой request/response
- какие статусы и ошибки
- какие ограничения (лимиты, размер файлов, политики)

После этого обновляем `api-contracts.yaml` и двигаемся к реализации.

---

## License / Notes

Внутренний проект. Контракты и код не публикуются без согласования.